{
  "hash": "fbc89e133eb5b2bb1a7cd75c7ef67631",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"1 线性回归模型\"\nauthor: \"李老师\"\nformat: html\neditor: source\n---\n目录\n基本假设\n参数估计（最小二乘法和MLE）\n假设检验（t检验，F检验，拟合优度）\n残差分析与异方差检验\n自相关检验、共线性检验\n模型修正与扩展（加权最小二乘WLS，广义最小二乘GLS）\n## 读取数据\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(haven) #包haven里的read_dta()可以读取stata的.dta格式数据            \ndata0 <- read_dta(\"data/grilic.dta\")\n#write_dta(datalm, \"datalm.dta\") #也可以把数据写出为.dta文件\ndata1 <- as.data.frame(data0) # 转换为R常用的数据框格式\nstr(data1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n'data.frame':\t758 obs. of  11 variables:\n $ rns   : num  0 0 0 0 0 0 0 0 0 0 ...\n  ..- attr(*, \"label\")= chr \"south = 1\"\n  ..- attr(*, \"format.stata\")= chr \"%8.0g\"\n $ mrt   : num  0 0 0 0 1 0 1 1 1 1 ...\n  ..- attr(*, \"label\")= chr \"married = 1\"\n  ..- attr(*, \"format.stata\")= chr \"%8.0g\"\n $ smsa  : num  1 1 1 1 1 1 1 0 1 0 ...\n  ..- attr(*, \"label\")= chr \"big cities =1\"\n  ..- attr(*, \"format.stata\")= chr \"%8.0g\"\n $ med   : num  8 14 14 12 6 8 8 14 12 13 ...\n  ..- attr(*, \"label\")= chr \"mother's education\"\n  ..- attr(*, \"format.stata\")= chr \"%8.0g\"\n $ iq    : num  93 119 108 96 74 91 114 111 95 132 ...\n  ..- attr(*, \"label\")= chr \"IQ\"\n  ..- attr(*, \"format.stata\")= chr \"%8.0g\"\n $ kww   : num  35 41 46 32 27 24 50 37 44 44 ...\n  ..- attr(*, \"label\")= chr \"KWW\"\n  ..- attr(*, \"format.stata\")= chr \"%8.0g\"\n $ age   : num  19 23 20 18 26 16 30 23 22 30 ...\n  ..- attr(*, \"label\")= chr \"age\"\n  ..- attr(*, \"format.stata\")= chr \"%8.0g\"\n $ s     : num  12 16 14 12 9 9 18 15 12 18 ...\n  ..- attr(*, \"label\")= chr \"schooling\"\n  ..- attr(*, \"format.stata\")= chr \"%8.0g\"\n $ expr  : num  0.462 0 0.423 0.333 9.013 ...\n  ..- attr(*, \"label\")= chr \"experience\"\n  ..- attr(*, \"format.stata\")= chr \"%9.0g\"\n $ tenure: num  0 2 1 1 3 1 6 1 2 5 ...\n  ..- attr(*, \"label\")= chr \"tenure\"\n  ..- attr(*, \"format.stata\")= chr \"%8.0g\"\n $ lnw   : num  5.9 5.44 5.71 5.48 5.93 ...\n  ..- attr(*, \"label\")= chr \"ln(wage)\"\n  ..- attr(*, \"format.stata\")= chr \"%9.0g\"\n```\n\n\n:::\n:::\n\n\n## 建立模型\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlm1=lm(lnw~s+expr+tenure+smsa+rns,data=data1)\nsummary(lm1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = lnw ~ s + expr + tenure + smsa + rns, data = data1)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-1.11684 -0.22626 -0.01511  0.23103  1.23738 \n\nCoefficients:\n             Estimate Std. Error t value Pr(>|t|)    \n(Intercept)  4.103675   0.085097  48.223  < 2e-16 ***\ns            0.102643   0.005849  17.549  < 2e-16 ***\nexpr         0.038119   0.006327   6.025 2.65e-09 ***\ntenure       0.035615   0.007742   4.600 4.96e-06 ***\nsmsa         0.139667   0.028082   4.974 8.15e-07 ***\nrns         -0.084080   0.028797  -2.920  0.00361 ** \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.3464 on 752 degrees of freedom\nMultiple R-squared:  0.3521,\tAdjusted R-squared:  0.3478 \nF-statistic: 81.75 on 5 and 752 DF,  p-value: < 2.2e-16\n```\n\n\n:::\n:::\n\n\n## 异方差与自相关检验\n\n建立模型\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(haven) #包haven里的read_dta()可以读取stata的.dta格式数据            \ndata07 <- read_dta(\"data/nerlove.dta\")\ndata7 <- as.data.frame(data07) # 转换为R常用的数据框格式\nstr(data7)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n'data.frame':\t145 obs. of  10 variables:\n $ tc  : num  0.082 0.661 0.99 0.315 0.197 ...\n  ..- attr(*, \"label\")= chr \"total cost\"\n  ..- attr(*, \"format.stata\")= chr \"%9.0g\"\n $ q   : num  2 3 4 4 5 9 11 13 13 22 ...\n  ..- attr(*, \"label\")= chr \"total output\"\n  ..- attr(*, \"format.stata\")= chr \"%8.0g\"\n $ pl  : num  2.1 2.1 2.1 1.8 2.1 ...\n  ..- attr(*, \"label\")= chr \"price of labor\"\n  ..- attr(*, \"format.stata\")= chr \"%9.0g\"\n $ pf  : num  17.9 35.1 35.1 32.2 28.6 ...\n  ..- attr(*, \"label\")= chr \"price of fuel\"\n  ..- attr(*, \"format.stata\")= chr \"%9.0g\"\n $ pk  : num  183 174 171 166 233 195 206 150 155 188 ...\n  ..- attr(*, \"label\")= chr \"user cost of capital\"\n  ..- attr(*, \"format.stata\")= chr \"%8.0g\"\n $ lntc: num  -2.501 -0.414 -0.0101 -1.1552 -1.6246 ...\n  ..- attr(*, \"label\")= chr \"log(tc)\"\n  ..- attr(*, \"format.stata\")= chr \"%9.0g\"\n $ lnq : num  0.693 1.099 1.386 1.386 1.609 ...\n  ..- attr(*, \"label\")= chr \"log(q)\"\n  ..- attr(*, \"format.stata\")= chr \"%9.0g\"\n $ lnpf: num  2.88 3.56 3.56 3.47 3.35 ...\n  ..- attr(*, \"label\")= chr \"log(pf)\"\n  ..- attr(*, \"format.stata\")= chr \"%9.0g\"\n $ lnpk: num  5.21 5.16 5.14 5.11 5.45 ...\n  ..- attr(*, \"label\")= chr \"log(pk)\"\n  ..- attr(*, \"format.stata\")= chr \"%9.0g\"\n $ lnpl: num  0.742 0.742 0.742 0.588 0.742 ...\n  ..- attr(*, \"label\")= chr \"log(pl)\"\n  ..- attr(*, \"format.stata\")= chr \"%9.0g\"\n - attr(*, \"label\")= chr \"Nerlove 1963 paper\"\n```\n\n\n:::\n\n```{.r .cell-code}\nlm7=lm(lntc~lnq+lnpl+lnpk+lnpf,data=data7)\nsummary(lm7)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = lntc ~ lnq + lnpl + lnpk + lnpf, data = data7)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-0.97203 -0.23377 -0.01091  0.16185  1.80985 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept) -3.56651    1.77938  -2.004    0.047 *  \nlnq          0.72091    0.01743  41.352  < 2e-16 ***\nlnpl         0.45596    0.29980   1.521    0.131    \nlnpk        -0.21515    0.33983  -0.633    0.528    \nlnpf         0.42581    0.10032   4.244 3.97e-05 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.3923 on 140 degrees of freedom\nMultiple R-squared:  0.926,\tAdjusted R-squared:  0.9239 \nF-statistic: 437.9 on 4 and 140 DF,  p-value: < 2.2e-16\n```\n\n\n:::\n:::\n\n\n## 异方差\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot( fitted (lm7), resid (lm7), xlab=' Fitted Values拟合值 ', ylab=' Residuals 残差值')\n```\n\n::: {.cell-output-display}\n![](1线性回归_files/figure-pdf/unnamed-chunk-4-1.pdf){fig-pos='H'}\n:::\n\n```{.r .cell-code}\nlibrary (lmtest)\nbptest(lm7) #Breusch-Pagan test 原假设：同方差\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tstudentized Breusch-Pagan test\n\ndata:  lm7\nBP = 36.163, df = 4, p-value = 2.678e-07\n```\n\n\n:::\n\n```{.r .cell-code}\ngqtest(lm7) #Goldfeld-Quandt检验 原假设：同方差\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tGoldfeld-Quandt test\n\ndata:  lm7\nGQ = 0.10989, df1 = 68, df2 = 67, p-value = 1\nalternative hypothesis: variance increases from segment 1 to 2\n```\n\n\n:::\n\n```{.r .cell-code}\nbptest(lm7,~lnq*lnpl+lnq^2+lnpl^2,data=data7) # White检验（在BP检验里面添加二次交叉项和平方项）\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tstudentized Breusch-Pagan test\n\ndata:  lm7\nBP = 37.374, df = 3, p-value = 3.835e-08\n```\n\n\n:::\n\n```{.r .cell-code}\n# lm7已经拟合好的线性回归模型对象， ~ x1*x2 + x1^2 + x2^2: 这是辅助回归的公式，用于检验异方差性的形式\n```\n:::\n\n\n加权最小二乘WLS\n\n\n::: {.cell}\n\n```{.r .cell-code}\ne1=lm7$residuals\nlne2=log(e1^2)\nlm71=lm(lne2~lnq,data=data7)\nsummary(lm71)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = lne2 ~ lnq, data = data7)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-9.0464 -1.2157  0.5291  1.5633  4.7791 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept) -0.74521    0.65910  -1.131     0.26    \nlnq         -0.44795    0.09653  -4.641 7.78e-06 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 2.216 on 143 degrees of freedom\nMultiple R-squared:  0.1309,\tAdjusted R-squared:  0.1248 \nF-statistic: 21.54 on 1 and 143 DF,  p-value: 7.779e-06\n```\n\n\n:::\n\n```{.r .cell-code}\nlm72=lm(lne2~lnq-1,data=data7)\nsummary(lm72)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = lne2 ~ lnq - 1, data = data7)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-9.1023 -1.3827  0.4031  1.4309  5.0371 \n\nCoefficients:\n    Estimate Std. Error t value Pr(>|t|)    \nlnq -0.55275    0.02697  -20.49   <2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 2.218 on 144 degrees of freedom\nMultiple R-squared:  0.7447,\tAdjusted R-squared:  0.7429 \nF-statistic: 419.9 on 1 and 144 DF,  p-value: < 2.2e-16\n```\n\n\n:::\n\n```{.r .cell-code}\ne2f=exp(lm72$residuals)\n\nlm73=lm(lntc~lnq+lnpl+lnpk+lnpf,data=data7,weights=e2f)\nsummary(lm73)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = lntc ~ lnq + lnpl + lnpk + lnpf, data = data7, weights = e2f)\n\nWeighted Residuals:\n    Min      1Q  Median      3Q     Max \n-3.0501 -0.5059 -0.1171  0.0159  5.6855 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept) -9.57427    1.59541  -6.001 1.59e-08 ***\nlnq          0.81415    0.02037  39.967  < 2e-16 ***\nlnpl         1.71526    0.40213   4.265 3.65e-05 ***\nlnpk         0.73074    0.34738   2.104   0.0372 *  \nlnpf         0.35529    0.20190   1.760   0.0806 .  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 1.004 on 140 degrees of freedom\nMultiple R-squared:  0.9389,\tAdjusted R-squared:  0.9371 \nF-statistic: 537.4 on 4 and 140 DF,  p-value: < 2.2e-16\n```\n\n\n:::\n\n```{.r .cell-code}\nbptest(lm73) #原假设：同方差\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tstudentized Breusch-Pagan test\n\ndata:  lm73\nBP = 673.07, df = 4, p-value < 2.2e-16\n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 专门为稳健推断设计的包\n#install.packages(\"estimatr\")\nlibrary(estimatr)\n# 一行代码实现加权+稳健标准误\nlm7_robust <- lm_robust(lntc~lnq+lnpl+lnpk+lnpf,data=data7,weights=e2f,se_type = \"stata\")\nsummary(lm7_robust)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm_robust(formula = lntc ~ lnq + lnpl + lnpk + lnpf, data = data7, \n    weights = e2f, se_type = \"stata\")\n\nWeighted, Standard error type:  HC1 \n\nCoefficients:\n            Estimate Std. Error t value  Pr(>|t|)  CI Lower CI Upper  DF\n(Intercept)  -9.5743    2.14301  -4.468 1.618e-05 -13.81113  -5.3374 140\nlnq           0.8142    0.05412  15.042 4.942e-31   0.70714   0.9212 140\nlnpl          1.7153    0.49705   3.451 7.388e-04   0.73258   2.6979 140\nlnpk          0.7307    0.41648   1.755 8.152e-02  -0.09266   1.5541 140\nlnpf          0.3553    0.23380   1.520 1.309e-01  -0.10695   0.8175 140\n\nMultiple R-squared:  0.9389 ,\tAdjusted R-squared:  0.9371 \nF-statistic: 147.7 on 4 and 140 DF,  p-value: < 2.2e-16\n```\n\n\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {
      "knitr": [
        "{\"type\":\"list\",\"attributes\":{},\"value\":[]}"
      ]
    },
    "preserve": null,
    "postProcess": false
  }
}