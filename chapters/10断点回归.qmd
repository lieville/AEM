---
title: "10 断点回归"
format: html
editor: visual
---

## 本章导读

断点回归是一种利用制度或规则中存在的"断点"来识别因果效应的准实验方法。当个体是否接受处理（或处理强度）取决于某个连续变量是否超过某个确定的阈值时，在阈值附近的小邻域内，个体的分配可被视为近似随机。本章将系统介绍断点回归的设计思想、核心假设、模型设定、有效性检验方法以及实际应用中的关键问题。通过学习，读者将理解RDD"局部随机实验"的独特逻辑，掌握执行与评估一项断点回归分析的完整流程。

## 10.1 断点回归的基本思想与设计逻辑

### 10.1.1 从"局部随机实验"的直观理解到正式定义

断点回归设计是一种准实验设计，它利用处理分配规则中的不连续性来识别因果效应。其核心思想是：当处理分配基于一个连续变量是否超过某个阈值时，在阈值附近的个体可以视为近似随机分配到处理组或对照组。

**形式化定义**： 设$X_i$为驱动变量（running variable或forcing variable），$c$为阈值。处理状态$D_i$由以下规则决定：

$$
D_i = 
\begin{cases} 
1 & \text{if } X_i \geq c \\
0 & \text{if } X_i < c
\end{cases}
$$

在精确断点回归中，该分配规则是确定性的；在模糊断点回归中，该规则是概率性的。

### 10.1.2 精确断点回归与模糊断点回归的区分

**精确断点回归**： 处理状态$D_i$是驱动变量$X_i$的确定性函数： $$
D_i = \mathbb{1}(X_i \geq c)
$$ 其中$\mathbb{1}(\cdot)$是指示函数。在精确RDD中，所有个体在阈值两侧的处理状态完全由驱动变量决定。

**模糊断点回归**： 处理状态$D_i$不是完全确定的，而是概率性的： $$
P(D_i=1 | X_i) = 
\begin{cases} 
p_1(X_i) & \text{if } X_i \geq c \\
p_0(X_i) & \text{if } X_i < c
\end{cases}
$$ 其中$p_1(c) \neq p_0(c)$，即在阈值处处理概率存在跳跃。

### 10.1.3 驱动变量、阈值与处理变量的关系

在断点回归设计中，三个核心要素的关系如下：

1.  **驱动变量**$X_i$：连续变量，决定个体是否接受处理
2.  **阈值**$c$：驱动变量的临界值，决定处理分配的断点
3.  **处理变量**$D_i$：二值或多值变量，表示个体是否接受处理

在精确RDD中，当$X_i \geq c$时，$D_i=1$；当$X_i < c$时，$D_i=0$。结果变量$Y_i$可以表示为： $$
Y_i = Y_i(0) + [Y_i(1) - Y_i(0)]D_i
$$ 其中$Y_i(1)$和$Y_i(0)$是潜在结果。

### 10.1.4 RDD与其他因果推断方法（IV，DID）的比较

| 方法     | 识别假设       | 适用场景               | 估计效应           |
|----------|----------------|------------------------|--------------------|
| 断点回归 | 连续性假设     | 存在明确分配规则和阈值 | 局部平均处理效应   |
| 工具变量 | 外生性和相关性 | 存在有效工具变量       | 依从者平均处理效应 |
| 双重差分 | 平行趋势假设   | 政策实施前后有面板数据 | 平均处理效应       |

**RDD的优势**： 1. 识别假设相对直观和可检验 2. 在阈值附近近似随机实验 3. 图形展示直观明了

**RDD的局限**： 1. 估计的是局部平均处理效应（LATE） 2. 需要足够样本量在阈值附近 3. 对外部有效性有限制

## 10.2 精确断点回归：识别与估计

### 10.2.1 潜在结果框架下的识别假设：连续性假设

精确断点回归的识别依赖于连续性假设：

**连续性假设**： 潜在结果函数$E[Y_i(0) | X_i=x]$和$E[Y_i(1) | X_i=x]$在$x=c$处连续。即： $$
\lim_{x \uparrow c} E[Y_i(0) | X_i=x] = \lim_{x \downarrow c} E[Y_i(0) | X_i=x]
$$ $$
\lim_{x \uparrow c} E[Y_i(1) | X_i=x] = \lim_{x \downarrow c} E[Y_i(1) | X_i=x]
$$

在连续性假设下，阈值处结果变量的跳跃只能归因于处理效应： $$
\tau_{SRD} = \lim_{x \downarrow c} E[Y_i | X_i=x] - \lim_{x \uparrow c} E[Y_i | X_i=x]
$$

### 10.2.2 局部多项式回归：带宽选择与核函数

断点回归通常使用局部多项式回归进行估计。考虑以下回归模型： $$
Y_i = \alpha + \tau D_i + f(X_i - c) + \epsilon_i
$$ 其中$f(\cdot)$是驱动变量的连续函数。

常用的估计方法是局部线性回归： $$
\min_{\alpha, \tau, \beta_l, \beta_r} \sum_{i=1}^n K\left(\frac{X_i - c}{h}\right) \left[Y_i - \alpha - \tau D_i - \beta_l (X_i - c) \cdot \mathbb{1}(X_i < c) - \beta_r (X_i - c) \cdot \mathbb{1}(X_i \geq c)\right]^2
$$ 其中$K(\cdot)$是核函数，$h$是带宽。

**常用核函数**： 1. 三角核：$K(u) = (1-|u|)\mathbb{1}(|u| \leq 1)$ 2. 均匀核：$K(u) = \frac{1}{2}\mathbb{1}(|u| \leq 1)$ 3. Epanechnikov核：$K(u) = \frac{3}{4}(1-u^2)\mathbb{1}(|u| \leq 1)$

### 10.2.3 参数化与非参数化估计策略

**参数化方法**： 使用全样本，在回归中包含驱动变量的高阶多项式： $$
Y_i = \alpha + \tau D_i + \sum_{j=1}^p \beta_j (X_i - c)^j + \sum_{j=1}^p \gamma_j (X_i - c)^j \cdot D_i + \epsilon_i
$$ 其中$p$是多项式阶数。

**非参数化方法**： 只使用带宽$h$内的样本，进行局部多项式回归。这是目前更常用的方法，因为它避免了多项式回归可能带来的外推问题。

### 10.2.4 最优带宽的选择方法

带宽选择是断点回归中的关键问题。带宽太小会导致估计方差大，带宽太大会导致估计偏差大。

**IMSE最优带宽**： Imbens和Kalyanaraman（2012）提出了基于均方误差最小化的带宽选择方法： $$
h_{IK} = C_{IK} \cdot n^{-1/5}
$$ 其中$C_{IK}$是一个依赖于数据特征的常数。

**交叉验证带宽**： 通过交叉验证选择使预测误差最小的带宽： $$
CV(h) = \frac{1}{n} \sum_{i=1}^n \left[Y_i - \hat{Y}_{(-i)}(X_i)\right]^2
$$ 其中$\hat{Y}_{(-i)}(X_i)$是剔除第$i$个观测后得到的预测值。

**经验法则**： 在实际应用中，通常报告多个带宽下的估计结果，以检验估计的稳健性。

### 10.2.5 断点处的平均处理效应估计与统计推断

断点处的平均处理效应估计量为： $$
\hat{\tau}_{SRD} = \hat{\mu}_+ - \hat{\mu}_-
$$ 其中$\hat{\mu}_+ = \lim_{x \downarrow c} \hat{E}[Y_i | X_i=x]$，$\hat{\mu}_- = \lim_{x \uparrow c} \hat{E}[Y_i | X_i=x]$。

**统计推断**： 使用局部线性回归时，可以构造$t$统计量： $$
t = \frac{\hat{\tau}_{SRD}}{SE(\hat{\tau}_{SRD})}
$$ 其中标准误$SE(\hat{\tau}_{SRD})$通常通过稳健标准误或自助法计算。

**置信区间**： 可以使用常规方法构建置信区间： $$
CI_{1-\alpha} = \hat{\tau}_{SRD} \pm z_{1-\alpha/2} \cdot SE(\hat{\tau}_{SRD})
$$ 或使用自助法构建置信区间。

## 10.3 模糊断点回归：工具变量视角

### 10.3.1 作为工具变量法的RDD：处理依从的非完全性

在模糊断点回归中，驱动变量超过阈值并不保证个体一定接受处理，而只是改变了接受处理的概率。因此，模糊RDD可以视为一种工具变量方法。

**设定**： 设$Z_i = \mathbb{1}(X_i \geq c)$为工具变量，$D_i$为内生处理变量，$Y_i$为结果变量。

第一阶段回归： $$
D_i = \pi_0 + \pi_1 Z_i + g(X_i - c) + v_i
$$ 其中$g(\cdot)$是驱动变量的连续函数。

第二阶段回归： $$
Y_i = \alpha + \tau D_i + f(X_i - c) + \epsilon_i
$$

### 10.3.2 两阶段最小二乘估计框架

模糊断点回归可以通过两阶段最小二乘法估计：

**第一阶段**：估计处理概率 $$
\hat{D}_i = \hat{\pi}_0 + \hat{\pi}_1 Z_i + \hat{g}(X_i - c)
$$

**第二阶段**：使用$\hat{D}_i$作为工具进行回归 $$
Y_i = \alpha + \tau \hat{D}_i + f(X_i - c) + \epsilon_i
$$

估计量$\hat{\tau}_{FRD}$可以表示为： $$
\hat{\tau}_{FRD} = \frac{\lim_{x \downarrow c} E[Y_i | X_i=x] - \lim_{x \uparrow c} E[Y_i | X_i=x]}{\lim_{x \downarrow c} E[D_i | X_i=x] - \lim_{x \uparrow c} E[D_i | X_i=x]}
$$

### 10.3.3 识别假设：驱动变量的排他性与相关性

模糊断点回归的识别需要以下假设：

**相关性假设**： 处理概率在阈值处存在跳跃： $$
\lim_{x \downarrow c} P(D_i=1 | X_i=x) \neq \lim_{x \uparrow c} P(D_i=1 | X_i=x)
$$

**排他性约束**： 驱动变量$X_i$只能通过处理状态$D_i$影响结果变量$Y_i$。形式化地： $$
(Y_i(1), Y_i(0)) \perp Z_i | X_i
$$ 在给定驱动变量$X_i$的条件下，工具变量$Z_i$与潜在结果独立。

**单调性假设**： 对于所有个体，有： $$
D_i(1) \geq D_i(0)
$$ 其中$D_i(z)$表示当$Z_i=z$时的潜在处理状态。

### 10.3.4 一阶段关系与工具变量有效性检验

在模糊断点回归中，需要检验工具变量的有效性：

**一阶段关系检验**： 检验处理概率在阈值处是否存在显著跳跃。可以估计： $$
D_i = \pi_0 + \pi_1 Z_i + \sum_{j=1}^p \beta_j (X_i - c)^j + \sum_{j=1}^p \gamma_j (X_i - c)^j \cdot Z_i + v_i
$$ 并检验$H_0: \pi_1 = 0$。

**F统计量检验**： 计算第一阶段的F统计量，检验工具变量与内生变量的相关性。经验上，F统计量应大于10。

## 10.4 有效性检验与稳健性分析

### 10.4.1 连续性假设的间接检验：协变量在断点处的平衡性检验

由于潜在结果无法直接观测，我们通过检验可观测协变量在断点处的连续性来间接检验连续性假设。

**方法**： 对于每个协变量$W_i$，检验： $$
\lim_{x \downarrow c} E[W_i | X_i=x] = \lim_{x \uparrow c} E[W_i | X_i=x]
$$

**检验步骤**： 1. 将每个协变量作为结果变量进行断点回归 2. 检验断点处协变量是否存在显著跳跃 3. 如果多个协变量都不存在显著跳跃，则增强了对连续性假设的信心

**图形展示**： 绘制协变量在驱动变量上的散点图和局部平滑线，观察在阈值处是否连续。

### 10.4.2 驱动变量的操纵检验：McCrary密度检验

如果个体能够精确操纵驱动变量，可能会导致断点两侧的个体不可比。McCrary（2008）提出了检验驱动变量密度连续性的方法。

**检验原理**： 如果个体不能操纵驱动变量，则驱动变量的密度函数在阈值处应该连续。如果存在操纵，则密度函数在阈值处会出现跳跃。

**检验步骤**： 1. 将驱动变量的支持划分为若干区间 2. 计算每个区间的观测频数 3. 在阈值两侧分别拟合密度函数 4. 检验阈值处密度是否连续

**原假设**： 驱动变量的密度函数在阈值处连续。

### 10.4.3 结果变量与协变量的预趋势检验

除了检验协变量在阈值处的平衡性，还可以检验协变量与驱动变量关系在阈值处的连续性。

**方法**： 对于协变量$W_i$，检验模型： $$
W_i = \alpha + \tau \mathbb{1}(X_i \geq c) + f(X_i - c) + \epsilon_i
$$ 中的$\tau$是否显著不为零。

如果$\tau$不显著，说明该协变量在阈值处没有跳跃，支持连续性假设。

### 10.4.4 带宽与函数形式的敏感性分析

断点回归的结果可能对带宽选择和函数形式设定敏感，因此需要进行敏感性分析。

**带宽敏感性分析**： 1. 使用不同带宽（如$0.5h_{opt}$、$h_{opt}$、$1.5h_{opt}$）进行估计 2. 比较不同带宽下的估计结果和标准误 3. 如果估计结果在不同带宽下稳定，则增强结果的可靠性

**函数形式敏感性分析**： 1. 使用不同阶数的多项式（如线性、二次、三次）进行估计 2. 比较不同函数形式下的估计结果 3. 使用非参数方法作为基准

### 10.4.5 安慰剂检验：伪断点与伪结果检验

安慰剂检验是检验断点回归结果稳健性的重要方法。

**伪断点检验**： 在真实的阈值之外选择其他点作为伪断点，检验在这些点上是否存在显著效应。如果在伪断点处也发现了显著效应，则可能表明观测到的效应不是由处理引起的。

**伪结果检验**： 使用理论上不应受处理影响的变量作为结果变量进行断点回归。如果发现了显著效应，则可能表明存在混杂因素或模型设定有问题。

## 10.5 扩展议题与前沿讨论

### 10.5.1 多变量与多维断点回归

当处理分配基于多个驱动变量时，需要使用多维断点回归。

**设定**： 设$X_{1i}$和$X_{2i}$为两个驱动变量，阈值为$(c_1, c_2)$。处理状态为： $$
D_i = \mathbb{1}(X_{1i} \geq c_1, X_{2i} \geq c_2)
$$

**识别挑战**： 在多维情况下，需要定义"接近"阈值的邻域，并估计该邻域内的处理效应。

**估计方法**： 1. 马氏距离法：使用$d_i = \sqrt{(X_{1i}-c_1)^2 + (X_{2i}-c_2)^2}$作为单维驱动变量 2. 非参数方法：在高维空间中进行局部回归

### 10.5.2 分位数处理效应断点回归

标准断点回归估计的是平均处理效应，但有时我们关心处理效应在整个分布上的异质性。

**分位数处理效应**： 设$Q_Y(\tau | X)$为结果变量$Y$在给定$X$下的$\tau$分位数。分位数处理效应定义为： $$
QTE(\tau) = Q_{Y(1)}(\tau | X=c) - Q_{Y(0)}(\tau | X=c)
$$

**估计方法**： 使用分位数回归框架，在阈值两侧分别拟合分位数回归模型，然后计算分位数处理效应。

### 10.5.3 非标准误差项的推断问题

在断点回归中，由于使用局部回归，误差项可能不满足经典假设，需要特殊处理。

**误差结构**： 1. 异方差性：误差方差可能随驱动变量变化 2. 自相关性：空间或时间上的相关性

**稳健推断方法**： 1. 自助法：特别是wild bootstrap，适用于异方差情况 2. 聚类标准误：当观测值存在聚类结构时 3. 基于设计的方法：利用断点回归的随机化性质

### 10.5.4 机器学习方法在RDD中的应用

近年来，机器学习方法被引入断点回归，以解决高维协变量和模型选择问题。

**应用场景**： 1. 最优带宽选择：使用机器学习方法选择最优带宽 2. 协变量调整：使用机器学习方法控制协变量 3. 异质性处理效应：使用机器学习方法识别处理效应的异质性

**常用方法**： 1. 岭回归和LASSO：用于高维协变量控制 2. 随机森林和梯度提升：用于灵活的函数形式 3. 神经网络：用于复杂的非线性关系

### 10.5.5 断点回归的内生阈值问题

在某些情况下，阈值本身可能是内生的，这会影响断点回归的识别。

**内生阈值来源**： 1. 阈值基于处理前的结果变量设定 2. 阈值随时间或空间变化 3. 个体知道阈值并可能操纵驱动变量

**解决方法**： 1. 使用工具变量法处理内生阈值 2. 使用双重差分法结合断点回归 3. 使用固定效应控制不可观测的异质性

## 10.6 应用案例与操作实践

### 10.6.1 经典案例回顾：班级规模对成绩的影响（Angrist & Lavy）

### 10.6.2 中国场景下的典型案例分析（如高考分数线、贫困线政策）

### 10.6.3 RDD在Stata/R中的实现命令与步骤（rdrobust，rdplot等）

### 10.6.4 研究设计中的常见陷阱与报告要点

## 本章总结

断点回归通过巧妙利用现实规则中存在的"断点"，在断点附近构造了一个近似随机的实验环境，从而为因果识别提供了可信的框架。其核心力量源于一个可检验的**连续性假设**，即个体在驱动变量阈值两侧是可比的。本章详细阐述了精确与模糊断点回归的识别策略、非参数估计方法以及一套系统的有效性检验工具。

断点回归的主要优势在于其清晰的识别假设和直观的图形展示，但同时也存在一些局限：首先，它估计的是**局部平均处理效应**，其外部有效性有限；其次，估计结果对带宽选择、函数形式等建模选择较为敏感；最后，需要足够大的样本量在阈值附近才能进行可靠的统计推断。

研究者在应用断点回归时，必须如同进行一项严格的实验般，透明地报告所有检验结果与稳健性分析，包括但不限于：协变量平衡性检验、McCrary密度检验、带宽敏感性分析、安慰剂检验等。同时，需要审慎地解释估计结果的局部性含义，避免过度外推。

随着计量经济学的发展，断点回归方法也在不断扩展，如多维断点回归、分位数处理效应断点回归、以及机器学习方法在RDD中的应用等，这些扩展丰富了断点回归的工具箱，使其能够应用于更复杂的研究场景。然而，无论方法如何扩展，对识别假设的深入理解和严格检验始终是应用断点回归的基石。