---
title: "1 线性回归基础"
author: "李老师"
format: html
editor: visual
---

## 本章导读

本章旨在系统梳理线性回归模型作为计量经济学核心方法的理论基石。我们将在先修课程的基础上，深化对**数据生成过程**的理解，并严格审视支撑经典推断的**基本假设体系**。本章不仅阐述在理想条件下（假设成立）模型所具有的最优性质，更将重点剖析当关键假设**被违反时**，对参数估计、统计推断与模型预测所造成的具体影响及其根本原因。这种"建构-解构"的视角，旨在培养严谨的实证思维习惯，为后续学习处理复杂现实数据的计量方法奠定坚实基础。

## 1.1 计量视角下的回归分析：一个回顾与统一

### 1.1.1 条件期望函数与最优线性预测

在计量经济学中，我们关注的是因变量$Y$在给定解释变量$X$的条件下的行为。条件期望函数（Conditional Expectation Function, CEF）定义为：

$$
E(Y|X) = f(X)
$$

其中$f(X)$是$X$的任意函数。条件期望函数具有一个重要性质：它是给定$X$下对$Y$的**最小均方误差预测**。即对于任意函数$g(X)$，有：

$$
E[(Y - f(X))^2|X] \leq E[(Y - g(X))^2|X]
$$

在实际应用中，我们通常不知道$f(X)$的函数形式。线性回归模型提供了一个简洁的近似框架：

$$
E(Y|X) \approx X\beta
$$

这里，$X\beta$是对真实条件期望函数的最佳线性预测。

### 1.1.2 总体回归与样本回归：统计推断的桥梁

计量经济学区分了两个关键概念：

1.  **总体回归函数**（Population Regression Function, PRF）： $$
    Y_i = X_i'\beta + \varepsilon_i,\quad i=1,...,N
    $$ 其中$\beta$是未知的总体参数，$\varepsilon_i$是随机扰动项，满足$E(\varepsilon_i|X_i)=0$。

2.  **样本回归函数**（Sample Regression Function, SRF）： $$
    Y_i = X_i'\hat{\beta} + \hat{\varepsilon}_i
    $$ 其中$\hat{\beta}$是基于样本数据对$\beta$的估计，$\hat{\varepsilon}_i$是残差项。

统计推断的核心任务就是从样本回归中获取关于总体回归的可靠信息。普通最小二乘（OLS）估计量$\hat{\beta}$通过最小化残差平方和得到：

$$
\hat{\beta} = \arg\min_{\beta} \sum_{i=1}^n (Y_i - X_i'\beta)^2
$$

在矩阵形式下，解为： $$
\hat{\beta} = (X'X)^{-1}X'Y
$$ 其中$X$为$n\times k$的解释变量矩阵，$Y$为$n\times 1$的被解释变量向量。

### 1.1.3 多元线性回归的矩阵表述与几何解释

考虑包含$n$个观测值和$k$个解释变量（包含常数项）的多元线性回归模型：

$$
Y = X\beta + \varepsilon
$$

其中： - $Y$为$n\times 1$的被解释变量向量 - $X$为$n\times k$的解释变量矩阵（秩为$k$） - $\beta$为$k\times 1$的未知参数向量 - $\varepsilon$为$n\times 1$的随机扰动向量

OLS估计量$\hat{\beta}$的几何解释为：通过将$Y$投影到$X$的列空间上，得到$Y$在该空间上的正交投影$\hat{Y} = X\hat{\beta} = P_X Y$，其中$P_X = X(X'X)^{-1}X'$为投影矩阵。残差向量$\hat{\varepsilon} = Y - \hat{Y} = (I_n - P_X)Y$垂直于$X$的列空间。

## 1.2 经典线性回归模型：假设体系、性质与关联

### 1.2.1 线性于参数：模型设定与误设偏误

经典线性回归模型假设因变量$Y$与参数$\beta$呈线性关系： $$
Y = X\beta + \varepsilon
$$ 这里的"线性"指的是对**参数**线性，而非对**变量**线性。模型可以包含变量的非线性变换（如对数、平方项等）。

**违反后果**：若真实关系非线性但误设为线性，则产生**模型设定偏误**，导致OLS估计量有偏且不一致。

### 1.2.2 严格外生性：无偏性与一致性的基石

严格外生性假设要求： $$
E(\varepsilon|X) = 0
$$ 这意味着给定所有解释变量$X$，扰动项的条件均值为零。一个较弱但足够的条件是均值独立： $$
E(\varepsilon_i|X_i) = 0,\quad i=1,...,n
$$

**违反后果**：当$E(\varepsilon_i|X_i) \neq 0$时（即$X$与$\varepsilon$相关），产生**内生性问题**，导致OLS估计量有偏且不一致。

常见原因包括：

1\. 遗漏重要变量

2\. 测量误差

3\. 联立性（双向因果关系）

4\. 样本选择偏误

### 1.2.3 无完全多重共线性：估计可行性与精度前提

无完全多重共线性要求解释变量矩阵$X$列满秩： $$
\text{rank}(X) = k
$$ 即不存在严格线性关系：$\sum_{j=1}^k a_j X_j = 0$（除非所有$a_j=0$）。

**违反后果**： 1. **完全共线性**：$(X'X)$不可逆，参数无法唯一识别 2. **近似共线性**：$(X'X)$接近奇异，导致： - 估计方差增大，估计精度下降 - 估计值对样本微小变化敏感 - $t$检验功效降低（难以拒绝原假设）

衡量共线性的常用指标是方差膨胀因子（VIF）： $$
\text{VIF}_j = \frac{1}{1-R_j^2}
$$ 其中$R_j^2$是$X_j$对其他解释变量回归的决定系数。通常认为VIF \> 10表明严重共线性。

### 1.2.4 球形扰动项假设：有效性基础

球形扰动项假设包含两个部分：

**(a) 同方差性**： $$
\text{Var}(\varepsilon_i|X) = \sigma^2,\quad \forall i=1,...,n
$$ 即扰动项的条件方差为常数。

**(b) 无自相关**： $$
\text{Cov}(\varepsilon_i, \varepsilon_j|X) = 0,\quad \forall i\neq j
$$ 即不同观测的扰动项相互独立。

在矩阵形式下，球形扰动项假设等价于： $$
\text{Var}(\varepsilon|X) = \sigma^2 I_n
$$

**违反后果**：当球形扰动项假设不成立时，OLS估计量仍是无偏和一致的，但**不再是有效的**（即不再具有最小方差），且常规标准误估计是有偏的，导致假设检验失效。

### 1.2.5 正态性假设：精确推断的充分条件

正态性假设要求： $$
\varepsilon|X \sim N(0, \sigma^2 I_n)
$$ 这是对扰动项分布的强化假设。

**影响**：

1\. **有限样本**：正态性假设下，OLS估计量服从精确的正态分布，$t$和$F$统计量分别服从精确的$t$和$F$分布

2\. **大样本**：由中心极限定理，即使扰动项非正态，OLS估计量也具有渐近正态性，大样本推断仍然有效

3\. **小样本非正态**：假设检验和置信区间的准确性可能受影响

### 1.2.6 关键性质与假设的关联总结

下表总结了经典线性回归模型主要性质所依赖的核心假设：

| 性质 | 核心依赖假设 | 违背后果 |
|------------------|------------------------------|------------------------|
| **无偏性** | 严格外生性 $E(\varepsilon\|X)=0$ | 估计量有偏 |
| **一致性** | 均值独立 $E(\varepsilon_i\|X_i)=0$ + 随机抽样 | 估计量不一致 |
| **有效性（最小方差）** | 同方差性 + 无自相关 | 不再是最优线性无偏估计 |
| **精确正态推断** | 正态性假设 | 小样本下检验可能不准确 |
| **大样本渐近推断** | 较弱的矩条件 | 通常仍成立 |

**高斯-马尔可夫定理**：在假设1.2.1-1.2.4下（线性性、严格外生性、无完全共线性、球形扰动项），OLS估计量是**最佳线性无偏估计量**（Best Linear Unbiased Estimator, BLUE），即在线性无偏估计量类中具有最小方差。

## 1.3 假设违反的后果：系统性影响分析

### 1.3.1 对参数估计量性质的影响

#### 有偏性与非一致性：外生性违背的灾难

当严格外生性假设$E(\varepsilon|X)=0$被违反时，设真实模型为： $$
Y = X\beta + \varepsilon,\quad E(\varepsilon|X) \neq 0
$$

则OLS估计量的概率极限为： $$
\text{plim}_{n\rightarrow\infty} \hat{\beta}_{OLS} = \beta + \text{plim}\left(\frac{X'X}{n}\right)^{-1} \text{plim}\left(\frac{X'\varepsilon}{n}\right)
$$

由于$E(X'\varepsilon) \neq 0$，第二项非零，导致估计量**不一致**。在有限样本下，估计量也**有偏**： $$
E(\hat{\beta}|X) = \beta + (X'X)^{-1}X'E(\varepsilon|X) \neq \beta
$$

#### 有效性丧失：球形扰动项违背的影响

当同方差性或无自相关假设被违反时，设$\text{Var}(\varepsilon|X) = \Omega \neq \sigma^2 I_n$，则OLS估计量的条件方差为： $$
\text{Var}(\hat{\beta}|X) = (X'X)^{-1}X'\Omega X(X'X)^{-1}
$$

而如果使用正确的广义最小二乘（GLS）估计量$\hat{\beta}_{GLS} = (X'\Omega^{-1}X)^{-1}X'\Omega^{-1}Y$，其方差为$(X'\Omega^{-1}X)^{-1}$。根据高斯-马尔可夫定理，对于任意$\Omega \neq \sigma^2 I_n$，有： $$
\text{Var}(\hat{\beta}_{GLS}|X) \leq \text{Var}(\hat{\beta}_{OLS}|X)
$$ 即OLS估计量**不是有效的**（方差不是最小）。

#### 估计不稳定与方差膨胀：多重共线性的影响

在近似多重共线性下，$(X'X)$接近奇异，其特征值中至少有一个非常小。OLS估计量的方差可以表示为： $$
\text{Var}(\hat{\beta}_j) = \frac{\sigma^2}{(1-R_j^2)\sum_{i=1}^n (X_{ij}-\bar{X}_j)^2}
$$

其中$(1-R_j^2)$项反映了$X_j$与其他解释变量的相关性。当$R_j^2 \rightarrow 1$时，方差趋于无穷大。虽然估计量仍无偏，但**估计精度严重下降**，估计值对样本微小变化极为敏感。

### 1.3.2 对统计假设检验的影响

#### 标准误估计偏误：异方差与自相关的后果

当存在异方差或自相关时，OLS的常规标准误估计： $$
\widehat{\text{Var}}(\hat{\beta}) = \hat{\sigma}^2 (X'X)^{-1},\quad \hat{\sigma}^2 = \frac{\hat{\varepsilon}'\hat{\varepsilon}}{n-k}
$$ 是有偏的。实际上，$\hat{\sigma}^2 (X'X)^{-1}$收敛于： $$
\text{plim} \hat{\sigma}^2 (X'X)^{-1} = \text{plim}\left(\frac{X'X}{n}\right)^{-1} \text{plim}\left(\frac{X'\varepsilon\varepsilon'X}{n}\right) \text{plim}\left(\frac{X'X}{n}\right)^{-1}
$$

而真实渐近方差为： $$
\text{Avar}(\hat{\beta}) = \text{plim}\left(\frac{X'X}{n}\right)^{-1} \text{plim}\left(\frac{X'\Omega X}{n}\right) \text{plim}\left(\frac{X'X}{n}\right)^{-1}
$$

两者相等仅当$\Omega = \sigma^2 I_n$。标准误的偏误方向取决于$\Omega$的结构： - **异方差**：常规标准误可能高估或低估真实标准误 - **正自相关**：常规标准误通常**低估**真实标准误，导致过度拒绝原假设（第一类错误增加）

#### 推断结论失真：检验水平与功效扭曲

错误的t统计量： $$
t_j = \frac{\hat{\beta}_j}{\text{se}(\hat{\beta}_j)}
$$ 不再服从标准正态或t分布（即使在渐近意义上），除非使用正确的标准误。这导致： 1. **检验水平扭曲**：实际显著性水平偏离名义水平（如5%） 2. **功效变化**：检验发现真实效应的能力改变 3. **置信区间失效**：实际覆盖率偏离置信水平

例如，当存在正自相关时，使用常规标准误的t检验会过度拒绝原假设（第一类错误膨胀）；而使用常规标准误的F检验也会有类似问题。

### 1.3.3 对模型预测的影响

#### 点预测偏误：参数估计偏误的传递

如果$\hat{\beta}$是有偏或不一致的，则点预测$\hat{Y}_0 = X_0'\hat{\beta}$也是有偏的： $$
E(\hat{Y}_0|X) = X_0'E(\hat{\beta}|X) \neq X_0'\beta
$$ 偏误大小为$X_0'[E(\hat{\beta}|X)-\beta]$。

#### 预测区间不准确：方差与分布误设

即使$\hat{\beta}$无偏，若标准误估计错误或扰动项分布误设，预测区间也会不准确。对于新观测$(X_0, Y_0)$，常规预测区间为： $$
\hat{Y}_0 \pm t_{\alpha/2, n-k} \times \hat{\sigma} \sqrt{1 + X_0'(X'X)^{-1}X_0}
$$

当存在异方差时，$\hat{\sigma}^2$不能准确估计预测方差；当存在自相关时，预测误差项$\varepsilon_0$与样本扰动项可能相关，进一步复杂化预测方差计算。这些都会导致预测区间的实际覆盖率偏离名义水平。

## 1.4 诊断、应对与因果推断的桥梁

### 1.4.1 诊断的逻辑：从理论先验到统计检验

计量经济学诊断应遵循系统化流程：

1.  **理论先验分析**：基于经济学理论判断可能存在的问题
    -   变量间理论上是否存在双向因果关系？
    -   是否可能遗漏了重要变量？
    -   数据生成过程是否暗示异方差或自相关？
2.  **数据可视化探索**：
    -   残差图：残差vs.拟合值、残差vs.解释变量
    -   分量加残差图（Partial Residual Plot）
    -   Q-Q图检验正态性
3.  **正式统计检验**：
    -   异方差检验：Breusch-Pagan检验、White检验
    -   自相关检验：Durbin-Watson检验、Breusch-Godfrey检验
    -   函数形式检验：RESET检验、Ramsey检验
    -   正态性检验：Jarque-Bera检验、Shapiro-Wilk检验

### 1.4.2 常见违背情形的应对路径导引

下表总结了主要假设违背的诊断方法及后续章节将详细讨论的应对策略：

| 违背类型 | 诊断方法 | 应对策略（后续章节） | 关键思想 |
|------------------|------------------|-------------------|------------------|
| **内生性** | 经济理论判断、Hausman检验 | 工具变量法（第4章）、面板数据模型（第3章） | 寻找外生变异来源 |
| **异方差** | 残差图、BP检验、White检验 | 稳健标准误（第2章）、WLS/FGLS（第2章） | 修正标准误或加权估计 |
| **自相关** | 残差图、DW检验、BG检验 | 聚类标准误（第2章）、时间序列模型（第5章） | 修正标准误或模型设定 |
| **非线性** | 残差图、RESET检验 | 函数形式变换（第2章）、非线性模型（第6章） | 更灵活的函数形式 |
| **共线性** | 相关系数矩阵、VIF | 变量筛选、主成分回归（第2章） | 降维或获取更多数据 |

### 1.4.3 从预测到因果：外生性假设的核心地位

线性回归可用于两个不同目的：

1.  **预测**：关注$E(Y|X)$的准确估计
    -   允许黑箱方法
    -   侧重样本内拟合与样本外预测精度
    -   不要求$X$外生
2.  **因果推断**：关注$\beta$的因果解释
    -   要求$E(\varepsilon|X)=0$（条件均值独立）
    -   $\beta_j$解释为：$X_j$外生变化一单位引起$Y$的**平均因果效应**
    -   需要证明/论证$X$的外生性

**因果识别的基本问题**：即使观测到$X$与$Y$相关，也无法区分： 1. $X$引起$Y$变化（因果效应） 2. $Y$引起$X$变化（反向因果） 3. 第三因素$Z$同时影响$X$和$Y$（混杂偏误）

**内生性问题的来源**： 1. **遗漏变量偏误**：未观测到的重要变量与$X$相关 2. **测量误差**：$X$的测量误差导致其与$\varepsilon$相关 3. **联立性偏误**：$X$与$Y$相互决定 4. **样本选择偏误**：样本非随机导致$X$与$\varepsilon$相关

这些内生性问题使得$E(\varepsilon|X)\neq 0$，破坏了因果解释的基础。第二部分（因果推断）将系统介绍解决这些问题的现代方法。

## 1.5 案例分析与代码实现

案例主题：教育回报率的实证分析——假设的审视与警示

核心目标：通过实际数据操作与模拟对比，直观感受假设成立与违反的差异。

分析步骤：

基准回归：使用OLS估计标准的Mincer方程，解释系数。

诊断探索：

绘制残差-拟合值图与残差-QQ图，进行直观诊断。

计算方差膨胀因子（VIF），诊断共线性。

后果演示（模拟辅助）：

内生性演示：模拟一个遗漏重要能力变量的场景，展示OLS估计量的偏误。

异方差后果：在一个存在已知异方差结构的数据中，对比普通标准误与异方差稳健标准误的差异，展示其对t检验结论的影响。

报告对比：整理并对比“理想情况”与“问题情况”下的回归结果表，强调正确诊断与报告的重要性。

代码实现要点 (R/Python双版本)：

数据操作与估计：pandas / statsmodels (Python) 或 dplyr / lm() (R)。

图形诊断：seaborn / matplotlib (Python) 或 ggplot2 (R)。

共线性诊断：statsmodels.stats.outliers_influence (Python) 或 car::vif (R)。

稳健标准误：statsmodels 的 cov_type 选项 (Python) 或 sandwich::vcovHC (R)。

数据模拟：使用 numpy (Python) 或自定义函数 (R) 生成具有特定数据缺陷的数据。

本章总结 本章构建了线性回归分析的完整逻辑框架：首先，确立了一个由线性性、严格外生性、无完全共线性、球形扰动项等构成的假设体系，并阐明了其与估计量无偏性、一致性、有效性等理论性质的严密关联。其次，系统分析了各类假设违反对估计、推断与预测三大环节的具体影响，揭示了传统OLS在现实应用中的局限性。最后，指明了诊断的初步思路与后续修正的基本路径，并凸显了外生性假设作为通往因果推断的关键桥梁地位。这一“假设-性质-违反-后果-诊断”的思维链条，是贯穿整个计量经济学学习的核心方法论。