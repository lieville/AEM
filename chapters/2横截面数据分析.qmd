---
title: "2 横截面数据：假设违反的诊断与修正"
author: "李老师"
format: html
editor: visual
---

## 本章导读

在第一章中，我们系统学习了经典线性回归模型的基本假设及其违反的后果。本章将转向现实世界中的横截面数据分析，聚焦于**诊断、修正和处理**各类违反经典假设的问题。横截面数据作为计量经济学中最常见的数据类型，其分析面临多重挑战：异方差、自相关、多重共线性、异常值、缺失数据以及空间相关性等。

本章遵循"**问题识别→理论修正→实践应用**"的逻辑框架，系统介绍针对各类问题的现代解决方法。我们不仅关注技术细节，更强调**方法的选择逻辑**与**结果的合理解释**。通过学习本章，您将掌握处理"不完美"横截面数据的完整工具箱，为进行严谨的实证研究奠定坚实基础。

## 2.1 异方差：诊断、修正与推断

### 2.1.1 异方差的来源与经济实例

异方差性（heteroskedasticity）指误差项的方差随解释变量变化而变化：

$$
\text{Var}(\varepsilon_i|X_i) = \sigma_i^2 \neq \text{常数}
$$

经济学中常见的异方差来源包括：

1.  **规模效应**：大企业、大城市的变量波动通常更大
2.  **学习效应**：经验积累减少行为不确定性
3.  **数据聚集**：按组平均导致方差系统性差异
4.  **异质性反应**：不同群体对相同政策反应不同

### 2.1.2 异方差的正式检验方法

#### 图示法

-   残差-拟合值图：$\hat{\varepsilon}_i$ vs. $\hat{Y}_i$
-   残差-解释变量图：$\hat{\varepsilon}_i$ vs. $X_{ij}$

#### Breusch-Pagan检验（LM检验）

1.  估计原模型得残差$\hat{\varepsilon}_i$
2.  辅助回归：$\hat{\varepsilon}_i^2 = \alpha_0 + Z_i'\gamma + v_i$
3.  检验统计量：$LM = nR^2 \sim \chi^2_{p-1}$，其中$R^2$为辅助回归决定系数

#### White检验

1.  将$\hat{\varepsilon}_i^2$对所有$X$、$X^2$及交叉项回归
2.  检验统计量：$W = nR^2 \sim \chi^2_q$，$q$为辅助回归中解释变量个数

### 2.1.3 异方差稳健标准误

当存在异方差时，OLS估计量的正确方差为：

$$
\text{Var}(\hat{\beta}|X) = (X'X)^{-1}(X'\Omega X)(X'X)^{-1}, \quad \Omega = \text{diag}(\sigma_1^2, ..., \sigma_n^2)
$$

White异方差稳健估计量：

$$
\widehat{\text{Var}}_{HC}(\hat{\beta}) = (X'X)^{-1} \left( \sum_{i=1}^n \hat{\varepsilon}_i^2 X_i X_i' \right) (X'X)^{-1}
$$

小样本修正系列： - HC0：基本White估计 - HC1：$\frac{n}{n-k}\hat{\varepsilon}_i^2$ - HC2：$\frac{\hat{\varepsilon}_i^2}{1-h_{ii}}$ - HC3：$\frac{\hat{\varepsilon}_i^2}{(1-h_{ii})^2}$

### 2.1.4 加权最小二乘法与可行GLS

#### 加权最小二乘法（WLS）

已知方差结构$\text{Var}(\varepsilon_i|X_i) = \sigma^2 w_i$时：

$$
\hat{\beta}_{WLS} = \left( \sum_{i=1}^n \frac{1}{w_i} X_i X_i' \right)^{-1} \left( \sum_{i=1}^n \frac{1}{w_i} X_i Y_i \right)
$$

#### 可行广义最小二乘法（FGLS）

两阶段估计： 1. OLS估计得$\hat{\varepsilon}_i$ 2. 估计$\log(\hat{\varepsilon}_i^2) = Z_i'\delta + v_i$ 3. 计算$\hat{w}_i = \exp(Z_i'\hat{\delta})$ 4. 使用WLS，权重为$1/\hat{w}_i$

## 2.2 自相关与聚类标准误

### 2.2.1 自相关的来源与类型

横截面数据中的自相关可能源于：

1.  **空间相依性**：地理位置接近的观测相关
2.  **聚类结构**：同一组内观测相关（学校、企业、行业）
3.  **网络效应**：社会网络或经济网络中的相互影响
4.  **时间维度**：重复横截面中的时间相关性

### 2.2.2 自相关的检验方法

#### 空间自相关检验

Moran's I统计量：

$$
I = \frac{n}{\sum_i \sum_j w_{ij}} \cdot \frac{\sum_i \sum_j w_{ij}(Y_i-\bar{Y})(Y_j-\bar{Y})}{\sum_i (Y_i-\bar{Y})^2}
$$

其中$w_{ij}$为空间权重矩阵元素。

#### 聚类内的自相关检验

对于聚类数据，可检验组内相关性： 1. 计算组内相关系数（ICC） 2. 进行Breusch-Godfrey类型检验的聚类版本

### 2.2.3 自相关的修正方法

#### 空间计量模型

-   空间自回归模型（SAR）：$Y = \rho WY + X\beta + \varepsilon$
-   空间误差模型（SEM）：$Y = X\beta + u, \quad u = \lambda Wu + \varepsilon$
-   空间杜宾模型（SDM）：$Y = \rho WY + X\beta + WX\theta + \varepsilon$

#### 聚类调整估计

对于已知聚类结构，可采用随机效应或固定效应模型。

### 2.2.4 聚类稳健标准误

#### 基本聚类标准误

假设数据分为$G$个聚类，聚类内任意相关，聚类间独立：

$$
\widehat{\text{Var}}_{\text{cluster}}(\hat{\beta}) = (X'X)^{-1} \left( \sum_{g=1}^G X_g' \hat{\varepsilon}_g \hat{\varepsilon}_g' X_g \right) (X'X)^{-1}
$$

其中$X_g$和$\hat{\varepsilon}_g$为第$g$个聚类的解释变量矩阵和残差向量。

#### 多路聚类标准误

当存在多个聚类维度时（如企业-行业-年份）：

$$
\widehat{\text{Var}}_{\text{multi}} = \widehat{\text{Var}}_1 + \widehat{\text{Var}}_2 - \widehat{\text{Var}}_{12}
$$

#### 少聚类问题的处理

当聚类数量$G$较小时： 1. 使用$t_{G-1}$分布而非正态分布 2. Bell-McCaffrey偏差修正 3. Wild bootstrap方法

#### 空间自相关稳健标准误

Conley（1999）空间HAC估计量：

$$
\widehat{\text{Var}}_{\text{Conley}} = (X'X)^{-1} \left( \sum_{i=1}^n \sum_{j=1}^n k(d_{ij}) X_i X_j' \hat{\varepsilon}_i \hat{\varepsilon}_j \right) (X'X)^{-1}
$$

其中$k(d_{ij})$为距离$d_{ij}$的核函数。

## 2.3 异常值、杠杆点与稳健估计

### 2.3.1 异常值的识别与诊断

#### 杠杆值

杠杆值$h_{ii} = X_i'(X'X)^{-1}X_i$，满足： - $0 \leq h_{ii} \leq 1$ - $\sum_{i=1}^n h_{ii} = k$ - 经验法则：$h_{ii} > 2k/n$为高杠杆点

#### 影响度量

1.  **学生化残差**：$r_i = \frac{\hat{\varepsilon}_i}{\hat{\sigma}\sqrt{1-h_{ii}}} \sim t_{n-k-1}$
2.  **Cook距离**：$D_i = \frac{(\hat{\beta}-\hat{\beta}_{(i)})'X'X(\hat{\beta}-\hat{\beta}_{(i)})}{k\hat{\sigma}^2}$
3.  **DFFITS**：$\text{DFFITS}_i = \frac{\hat{Y}_i - \hat{Y}_{i(i)}}{\hat{\sigma}_{(i)}\sqrt{h_{ii}}}$

### 2.3.2 异常值的处理策略

#### 数据核查

检查异常值是否数据错误，如是则修正或删除。

#### 稳健回归方法

**M估计**：最小化$\sum_{i=1}^n \rho\left(\frac{Y_i-X_i'\beta}{\sigma}\right)$ 常见$\rho$函数： - Huber：$\rho(z) = \begin{cases} z^2/2 & |z|\leq c \\ c|z|-c^2/2 & |z|>c \end{cases}$ - Tukey双权：$\rho(z) = \begin{cases} \frac{c^2}{6}[1-(1-(z/c)^2)^3] & |z|\leq c \\ c^2/6 & |z|>c \end{cases}$

**S估计与MM估计**： - S估计：最小化残差的尺度估计，高崩溃点 - MM估计：结合高崩溃点S估计与高效率M估计

### 2.3.3 分位数回归

#### 基本模型

$\tau$分位数回归估计量：

$$
\hat{\beta}(\tau) = \arg\min_{\beta} \sum_{i=1}^n \rho_\tau(Y_i - X_i'\beta)
$$

其中检验函数$\rho_\tau(u) = u(\tau - I(u<0))$。

#### 渐近性质

在独立同分布下：

$$
\sqrt{n}(\hat{\beta}(\tau) - \beta(\tau)) \stackrel{d}{\rightarrow} N(0, \tau(1-\tau)D_1^{-1}D_0D_1^{-1})
$$

其中$D_0 = E[f_{Y|X}(0)X_iX_i']$，$D_1 = E[X_iX_i']$。

#### 优势与应用

1.  对异常值稳健
2.  描述条件分布全貌
3.  无需分布假设
4.  单调变换下性质良好

## 2.4 缺失数据处理

### 2.4.1 缺失数据机制

Rubin（1976）分类： 1. **完全随机缺失（MCAR）**：$P(M_i=1|Y_i^{\text{obs}}, Y_i^{\text{mis}}, X_i) = P(M_i=1)$ 2. **随机缺失（MAR）**：$P(M_i=1|Y_i^{\text{obs}}, Y_i^{\text{mis}}, X_i) = P(M_i=1|Y_i^{\text{obs}}, X_i)$ 3. **非随机缺失（MNAR）**：缺失依赖于未观测值

### 2.4.2 多重插补方法

#### Rubin规则

设$m$个插补数据集，第$j$个数据集的估计为$\hat{\theta}_j$，方差为$U_j$： - 合并估计：$\bar{\theta} = \frac{1}{m}\sum_{j=1}^m \hat{\theta}_j$ - 合并方差：$T = \bar{U} + (1+\frac{1}{m})B$ 其中$\bar{U} = \frac{1}{m}\sum_{j=1}^m U_j$，$B = \frac{1}{m-1}\sum_{j=1}^m (\hat{\theta}_j - \bar{\theta})^2$

#### MICE算法

链式方程多重插补步骤： 1. 为每个缺失变量指定条件分布 2. 通过迭代Gibbs抽样生成插补值 3. 重复生成$m$个完整数据集

### 2.4.3 选择模型与逆概率加权

#### Heckman选择模型

两步估计法： 1. 选择方程：$D_i^* = Z_i'\gamma + u_i$，$D_i = I(D_i^* > 0)$ 2. 结果方程：$Y_i = X_i'\beta + \varepsilon_i$，仅当$D_i=1$时观测

逆米尔斯比率调整： $$
E(Y_i|X_i, D_i=1) = X_i'\beta + \rho\sigma_\varepsilon \lambda(Z_i'\gamma)
$$

#### 逆概率加权（IPW）

$$
\hat{\beta}_{\text{IPW}} = \left( \sum_{i=1}^n \frac{D_i}{\hat{p}_i} X_i X_i' \right)^{-1} \left( \sum_{i=1}^n \frac{D_i}{\hat{p}_i} X_i Y_i \right)
$$ 其中$\hat{p}_i = P(D_i=1|Z_i)$为倾向得分。

#### 双重稳健估计

结合回归调整与IPW： $$
\hat{\beta}_{\text{DR}} = \left( \sum_{i=1}^n X_i X_i' \right)^{-1} \sum_{i=1}^n \left[ \frac{D_i}{\hat{p}_i}(Y_i - X_i'\hat{\beta}_{\text{reg}}) + X_i'\hat{\beta}_{\text{reg}} \right] X_i
$$ 只要倾向得分模型或结果模型之一正确，估计即一致。

## 2.5 多重共线性：诊断、修正与推断

### 2.5.1 多重共线性的来源与识别

#### 来源

1.  **经济变量间的内在关联**：如收入与消费、价格与需求量
2.  **变量构造**：多项式项、交互项与原始变量相关
3.  **数据限制**：样本变异不足，变量变化范围小
4.  **过度参数化**：模型包含过多解释变量

#### 识别方法

1.  **方差膨胀因子（VIF）**： $$
    \text{VIF}_j = \frac{1}{1-R_j^2}
    $$ 其中$R_j^2$是$X_j$对其他解释变量回归的决定系数。通常VIF \> 10表明严重共线性。

2.  **条件数（Condition Number）**： $$
    \kappa = \sqrt{\frac{\lambda_{\max}}{\lambda_{\min}}}
    $$ 其中$\lambda_{\max}$和$\lambda_{\min}$是$X'X$的最大和最小特征值。$\kappa > 30$表明严重共线性。

3.  **特征分析**：小特征值对应的特征向量可识别近似线性关系。

### 2.5.2 多重共线性的后果

#### 对估计量的影响

1.  **无偏性**：OLS估计量仍无偏（在外生性成立下）

2.  **方差增大**： $$
    \text{Var}(\hat{\beta}_j) = \frac{\sigma^2}{(1-R_j^2)\sum_{i=1}^n (X_{ij}-\bar{X}_j)^2}
    $$ 共线性使$R_j^2 \rightarrow 1$，方差$\rightarrow \infty$

3.  **估计不稳定性**：微小数据变化导致估计值大幅变动

4.  **系数符号反常**：估计系数符号可能与理论预期相反

#### 对推断的影响

1.  **t检验失效**：由于方差膨胀，$t$统计量变小，难以拒绝$\beta_j=0$的原假设
2.  **置信区间变宽**：参数估计的不确定性增加
3.  **模型预测能力下降**：样本外预测方差增大

### 2.5.3 多重共线性的修正方法

#### 理论与方法选择

1.  **增加样本量**：收集更多数据减少共线性
2.  **变量变换**：对变量进行中心化、标准化或差分处理
3.  **删除冗余变量**：基于理论或统计检验删除不必要变量
4.  降维
5.  正则化：

#### 

### 2.5.4 高维数据的正则化方法

### 岭回归

岭估计量： $$
\hat{\beta}_{\text{ridge}} = (X'X + \lambda I)^{-1}X'Y
$$ 其中$\lambda > 0$为调节参数。

偏差-方差权衡： - 偏差：$E(\hat{\beta}_{\text{ridge}}) - \beta = -\lambda(X'X + \lambda I)^{-1}\beta$ - 方差：$\text{Var}(\hat{\beta}_{\text{ridge}}) = \sigma^2(X'X + \lambda I)^{-1}X'X(X'X + \lambda I)^{-1}$

#### Lasso回归

Lasso估计量： $$
\hat{\beta}_{\text{lasso}} = \arg\min_{\beta} \left\{ \sum_{i=1}^n (Y_i - X_i'\beta)^2 + \lambda \sum_{j=1}^p |\beta_j| \right\}
$$

性质： 1. 产生稀疏解，实现变量选择 2. 当$p > n$时仍可估计 3. 解路径为分段线性

#### 弹性网

结合L1和L2惩罚： $$
\hat{\beta}_{\text{en}} = \arg\min_{\beta} \left\{ \sum_{i=1}^n (Y_i - X_i'\beta)^2 + \lambda \left[ \alpha \sum_{j=1}^p |\beta_j| + \frac{1}{2}(1-\alpha) \sum_{j=1}^p \beta_j^2 \right] \right\}
$$

优势： 1. 处理高度相关变量时比Lasso更稳定 2. 当$p > n$时最多可选择$n$个变量

#### 高维因果推断

**双重选择Lasso**（Belloni等，2014）： 1. 用Lasso选择与处理变量$D$相关的控制变量 2. 用Lasso选择与结果$Y$相关的控制变量 3. 合并两步选择的变量，用OLS估计处理效应

### 2.5.5 降维

#### 主成分回归

设$X$的奇异值分解：$X = U\Lambda V'$ 取前$r$个主成分：$Z = XV_r$，其中$V_r$为前$r$个右奇异向量 主成分回归估计：$\hat{\beta}_{PCR} = V_r(V_r'X'XV_r)^{-1}V_r'X'Y$

## 2.6 空间与网络数据建模引论

### 2.6.1 空间自相关的识别

#### 空间权重矩阵

常见形式： 1. **邻接矩阵**：$w_{ij} = I(i \text{与} j \text{相邻})$ 2. **距离矩阵**：$w_{ij} = 1/d_{ij}^\alpha$ 3. **k最近邻矩阵**：每个单元与最近的$k$个单元连接

#### 空间自相关检验

**Moran's I检验**： 原假设$H_0$：无空间自相关 标准化统计量：$Z = \frac{I - E(I)}{\sqrt{\text{Var}(I)}} \sim N(0,1)$

**Geary's C统计量**： $$
C = \frac{(n-1)\sum_i \sum_j w_{ij}(Y_i-Y_j)^2}{2\sum_i \sum_j w_{ij} \sum_i (Y_i-\bar{Y})^2}
$$

### 2.6.2 空间计量模型简介

#### 空间自回归模型（SAR）

$$
Y = \rho WY + X\beta + \varepsilon, \quad \varepsilon \sim N(0, \sigma^2 I_n)
$$ 其中$\rho$为空间自回归系数，$W$为空间权重矩阵。

#### 空间误差模型（SEM）

$$
Y = X\beta + u, \quad u = \lambda Wu + \varepsilon, \quad \varepsilon \sim N(0, \sigma^2 I_n)
$$ 其中$\lambda$为空间误差系数。

#### 空间杜宾模型（SDM）

$$
Y = \rho WY + X\beta + WX\theta + \varepsilon
$$ 包含因变量和解释变量的空间滞后。

### 2.6.3 网络自相关模型

#### 网络权重矩阵

基于网络结构的连接矩阵$G$： - 无向网络：$g_{ij} = g_{ji}$ - 有向网络：$g_{ij} \neq g_{ji}$（如引文网络） - 加权网络：$g_{ij}$表示连接强度

#### 网络自回归模型

$$
Y = \alpha GY + X\beta + \varepsilon
$$ 其中$\alpha$度量网络效应强度。

#### 识别挑战

**反射问题**（reflection problem）：个体的行为影响邻居，邻居的行为又影响个体，导致双向因果。解决方法： 1. 使用工具变量 2. 利用网络结构特征（如朋友的朋发特征） 3. 实验或准实验设计

## 2.7 综合诊断框架与模型选择

### 2.7.1 系统化的诊断流程

#### 诊断顺序建议

1.  **理论先验分析**：基于经济学理论判断可能问题
2.  **描述性统计分析**：数据可视化，发现异常模式
3.  **基础假设检验**：异方差、自相关、正态性检验
4.  **模型设定检验**：RESET检验、非线性检验
5.  **多重共线性诊断**：VIF、条件数分析
6.  **稳健性检查**：不同方法、不同样本下的结果比较

#### 诊断结果整合

建立诊断记录表，记录： - 检验方法 - 检验统计量与p值 - 问题严重程度评估 - 建议的修正措施

### 2.7.2 模型选择与模型平均

#### 信息准则

1.  **AIC**（Akaike Information Criterion）： $$
    \text{AIC} = 2k - 2\ln(L)
    $$ 倾向于选择更复杂的模型。

2.  **BIC**（Bayesian Information Criterion）： $$
    \text{BIC} = k\ln(n) - 2\ln(L)
    $$ 对模型复杂度惩罚更重，倾向于更简洁的模型。

#### 交叉验证

**K折交叉验证步骤**： 1. 随机将数据分为$K$份 2. 每次用$K-1$份训练，1份测试 3. 重复$K$次，计算平均预测误差

**留一法交叉验证**：$K=n$的特殊情况。

#### 模型平均方法

1.  **贝叶斯模型平均（BMA）**： $$
    \hat{\beta}_{\text{BMA}} = \sum_{m=1}^M w_m \hat{\beta}_m
    $$ 其中$w_m = P(M_m|Y)$为后验模型概率。

2.  **堆叠法（Stacking）**： 基于交叉验证表现确定权重，最小化预测误差。

### 2.7.3 实证研究中的报告规范

#### 透明度原则

1.  **数据描述**：清晰说明数据来源、处理过程、样本选择
2.  **方法报告**：详细描述估计方法、检验方法、软件与版本
3.  **结果呈现**：报告所有相关结果，包括不显著的结果
4.  **复制材料**：提供代码、数据、详细结果供他人复制

#### 敏感性分析

应报告以下敏感性分析： 1. **模型设定敏感性**：不同函数形式、不同控制变量集 2. **估计方法敏感性**：不同估计方法（OLS、IV、GMM等） 3. **样本选择敏感性**：不同子样本、不同时间区间 4. **异常值处理敏感性**：包含/排除异常值的结果比较

#### 谨慎解释

1.  **区分统计显著性与经济显著性**：不仅报告p值，还要讨论经济意义
2.  **承认局限性**：明确说明研究的假设、局限性和推广范围
3.  **避免过度推断**：基于证据的谨慎结论，不夸大发现

## 2.8 案例分析与代码实现

*（本章案例将聚焦于一个综合性的实证研究，展示如何系统应用本章介绍的各种方法诊断和处理横截面数据中的多重问题。具体内容将在教材配套材料中详细展开。）*

## 本章总结

本章系统介绍了处理横截面数据中违反经典回归假设的现代方法。我们从异方差这一最常见问题出发，逐步深入到更复杂的自相关、多重共线性、异常值、缺失数据以及空间网络相关问题。关键要点包括：

1.  **诊断优先**：任何修正方法的应用都应基于准确的诊断。异方差的图示法和统计检验、自相关的空间检验、多重共线性的VIF分析等，都是必要的前期工作。

2.  **方法选择的权衡**：效率与稳健性、偏差与方差、简洁性与准确性之间的权衡是方法选择的核心考量。例如：

    -   当异方差形式未知时，稳健标准误比FGLS更可靠
    -   当存在异常值时，分位数回归比OLS更稳健
    -   当存在多重共线性时，岭回归比删除变量更能保留信息

3.  **标准误的稳健性至关重要**：在实证研究中，正确的标准误是进行有效统计推断的基础。聚类标准误、异方差稳健标准误、空间HAC标准误等，都是应对不同相关结构的工具。

4.  **处理复杂数据结构的现代方法**：对于高维数据、缺失数据、空间网络数据，计量经济学发展了一系列现代方法：

    -   正则化方法（Lasso、弹性网）处理高维数据
    -   多重插补和双重稳健估计处理缺失数据
    -   空间计量模型处理空间相关性

5.  **综合诊断与透明报告**：良好的实证研究应遵循系统化的诊断流程，并透明报告所有步骤和结果。敏感性分析和稳健性检查是评估结论可靠性的关键。

通过本章的学习，您将具备处理现实世界横截面数据的全面能力，为进行严谨、可信的实证经济学研究打下坚实基础。在后续章节中，我们将把重点转向因果推断这一计量经济学的核心目标，这些处理数据问题的技术将成为我们进行可信因果推断的重要前提。

**要点回顾**： - 异方差使OLS无效但依然一致，可使用稳健标准误或WLS/FGLS修正 - 自相关（空间相关、聚类相关）需使用聚类标准误或空间计量模型 - 异常值可通过稳健回归或分位数回归处理 - 缺失数据机制决定处理方法，多重插补和双重稳健估计是常用方法 - 多重共线性增加估计方差但不影响无偏性，可通过正则化方法处理 - 空间网络数据需要专门的模型和推断方法

掌握这些方法的关键不仅是理解其数学原理，更是能够在具体研究问题中做出恰当的方法选择，并对结果进行合理解释。这正是计量经济学作为一门应用科学的核心要义。