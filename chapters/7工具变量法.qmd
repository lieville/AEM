---
title: "7 工具变量法"
format: html
editor: visual
---

## 本章导读

在观察性研究中，当解释变量因测量误差、双向因果关系或不可观测的遗漏变量而与误差项相关时，常规的回归估计将失效。本章系统介绍解决此类内生性问题的核心方法之一——**工具变量法**。其基本思想是寻找一个满足特定条件的外部变量（工具变量），该变量与内生解释变量高度相关，但**仅通过该内生变量影响结果变量**，从而提供了一个可用于识别因果关系的“外生变异”来源。本章将从IV的直观逻辑入手，详细阐述其识别条件、核心估计方法（两阶段最小二乘法）、严格的统计检验以及在实际应用中的关键问题。

## 7.1 工具变量法的引入：动机与基本思想

### 7.1.1 OLS的内生性问题回顾与IV的针对性

考虑线性回归模型 $y_i = \beta_0 + \beta_1 x_i + u_i$。当 $x_i$ 与误差项 $u_i$ 相关（即存在内生性）时，OLS估计量 $\hat{\beta}_1^{OLS}$ 不一致： $$
\text{plim} \ \hat{\beta}_1^{OLS} = \beta_1 + \frac{Cov(x_i, u_i)}{Var(x_i)} \neq \beta_1.
$$ 内生性可能源于**测量误差**、**双向因果**或**遗漏不可观测变量**。工具变量法为此提供了一种解决方案：找到一个工具变量 $z_i$，它仅通过影响 $x_i$ 来间接影响 $y_i$，从而利用 $z_i$ 带来的外生变异识别 $\beta_1$。

### 7.1.2 工具变量法的直观类比与核心思想

工具变量的核心思想可通过“分而治之”来理解： 1. **第一阶段**：工具变量 $z_i$ 与内生变量 $x_i$ 相关（$Cov(z_i, x_i) \neq 0$），因此 $z_i$ 的变化能预测 $x_i$ 的变化。 2. **排他性**：工具变量 $z_i$ 与误差项 $u_i$ 不相关（$Cov(z_i, u_i) = 0$），因此 $z_i$ 的变化不会直接干扰 $y_i$。 3. **识别**：因此，$y_i$ 中与 $z_i$ 相关的变动，只能是通过 $x_i$ 传导的变动，从而可用于估计 $x_i$ 对 $y_i$ 的因果效应 $\beta_1$。

### 7.1.3 一个简单的工具变量模型设定

考虑模型 $y_i = \beta_0 + \beta_1 x_i + u_i$，其中 $x_i$ 内生。假设存在有效的工具变量 $z_i$，其满足两个核心条件： 1. **相关性**：$Cov(z_i, x_i) \neq 0$。 2. **外生性**：$Cov(z_i, u_i) = 0$。

基于矩条件 $E[u_i]=0$ 和 $E[z_i u_i]=0$，可推导出工具变量估计量（简单情形下）： $$
\hat{\beta}_1^{IV} = \frac{\sum_{i=1}^n (z_i - \bar{z})(y_i - \bar{y})}{\sum_{i=1}^n (z_i - \bar{z})(x_i - \bar{x})} = \frac{\widehat{Cov}(z_i, y_i)}{\widehat{Cov}(z_i, x_i)}.
$$ 这直观地表示为“$z_i$ 对 $y_i$ 的效应”与“$z_i$ 对 $x_i$ 的效应”之比。

## 7.2 工具变量的定义与识别条件

### 7.2.1 工具变量的两个关键假设：相关性与外生性

对于模型 $y_i = \beta_0 + \beta_1 x_i + u_i$，变量 $z_i$ 是 $x_i$ 的一个有效工具变量，若满足： - **相关性条件**：$Cov(z_i, x_i) \neq 0$。该条件可直接用数据检验。 - **外生性条件**：$Cov(z_i, u_i) = 0$。该条件涉及不可观测的 $u_i$，通常无法直接检验，必须基于经济理论与研究设计进行论证。它等价于要求 $z_i$ 只能通过 $x_i$ 影响 $y_i$，而不能存在其他直接或间接的路径。

### 7.2.2 排他性约束及其经济含义

外生性条件通常被称为 **“排他性约束”**。它要求工具变量 $z_i$ 对结果变量 $y_i$ 的所有影响都必须通过内生解释变量 $x_i$ 这一唯一渠道。 用因果图表示，有效的关系应为 $z_i \rightarrow x_i \rightarrow y_i$，而不能存在 $z_i \rightarrow y_i$ 的直接路径，或 $z_i \rightarrow W \rightarrow y_i$ 的间接路径（其中 $W$ 为未包含在模型中的其他变量）。违反排他性约束将导致 IV 估计量不一致。

### 7.2.3 识别条件：恰好识别与过度识别

-   **恰好识别**：工具变量的数量（$L$）等于内生解释变量的数量（$K$），即 $L = K$。此时参数有唯一解。
-   **过度识别**：工具变量的数量多于内生解释变量的数量，即 $L > K$。过度识别提供了检验工具变量外生性的可能性（如过度识别检验），且通常可以提高估计效率。
-   **不足识别**：$L < K$。模型无法识别所有参数。

## 7.3 两阶段最小二乘法

### 7.3.1 2SLS的估计步骤与几何解释

两阶段最小二乘法是估计工具变量模型最常用的方法，尤其适用于过度识别情形。设有单一内生变量 $x_i$ 和多个工具变量 $z_{1i}, ..., z_{Li}$。

**第一阶段**：将内生变量 $x_i$ 对所有工具变量 $z_{li}$ 及模型中的外生变量 $w_i$（若有）进行回归： $$
x_i = \pi_0 + \pi_1 z_{1i} + ... + \pi_L z_{Li} + \delta w_i + v_i.
$$ 得到 $x_i$ 的预测值 $\hat{x}_i$。$\hat{x}_i$ 是 $z_i$ 的线性组合，因此与 $u_i$ 不相关。

**第二阶段**：将结果变量 $y_i$ 对第一阶段预测值 $\hat{x}_i$ 及外生变量 $w_i$ 进行回归： $$
y_i = \beta_0 + \beta_1 \hat{x}_i + \gamma w_i + \epsilon_i.
$$ 所得 $\hat{\beta}_1^{2SLS}$ 即为一致估计量。几何上，2SLS 先将 $x_i$ 投影到工具变量张成的空间，再将 $y_i$ 投影到该预测值上。

### 7.3.2 2SLS估计量的统计性质（一致性、渐近正态性）

在工具变量相关性及外生性条件下，2SLS 估计量具有以下性质： - **一致性**：$\text{plim} \ \hat{\beta}_1^{2SLS} = \beta_1$。 - **渐近正态性**：$\sqrt{n}(\hat{\beta}_1^{2SLS} - \beta_1) \xrightarrow{d} N(0, \sigma^2 Q_{ZX}^{-1} Q_{ZZ} Q_{XZ}^{-1})$，其中 $Q_{ZX} = \text{plim}(Z'X/n)$ 等。这使得我们可以进行标准的假设检验。

### 7.3.3 2SLS估计的标准误计算

2SLS估计量的方差-协方差矩阵估计为 $\widehat{Var}(\hat{\beta}^{2SLS}) = \hat{\sigma}^2 (X'P_Z X)^{-1}$，其中 $P_Z = Z(Z'Z)^{-1}Z'$，$\hat{\sigma}^2$ 为第二阶段回归残差的方差估计。 **重要提示**：直接使用第二阶段OLS回归的标准误是错误的，必须使用上述考虑了 $\hat{x}_i$ 是估计得来的公式。现代计量软件（如 Stata 的 `ivregress`，R 的 `AER` 包中的 `ivreg()`）会自动计算正确的标准误。

## 7.4 工具变量的检验

### 7.4.1 相关性检验：弱工具变量问题

当工具变量与内生变量的相关性较弱时，会引发严重的 **弱工具变量问题**，导致： 1. 2SLS 估计量的小样本偏差可能很大。 2. 即使在大样本下，估计量的分布也可能严重偏离正态分布，导致推断错误。

**检验方法**：对于单个内生变量，通常使用**第一阶段回归的 F 统计量**来检验联合显著性 $H_0: \pi_1 = ... = \pi_L = 0$。 - **经验准则（Staiger & Stock, 1997）**：若第一阶段 F 统计量小于 10，则认为存在弱工具变量问题。 - 对于多个内生变量，可使用 Cragg-Donald Wald F 统计量或 Kleibergen-Paap rk Wald F 统计量（适用于异方差或自相关情形）。

### 7.4.2 外生性检验：过度识别检验

当模型为过度识别（$L > K$）时，可以进行 **过度识别检验**（如 Sargan 检验或 Hansen J 检验），其原假设为“所有工具变量均为外生”。 - 检验统计量基于 2SLS 残差与工具变量的相关性构造，在原假设下服从 $\chi^2(L-K)$ 分布。 - **重要提示**：该检验只能检验“过度识别”的工具变量是否整体外生。若模型恰好识别（$L=K$），则无法进行此检验。拒绝原假设意味着至少有一个工具变量不满足外生性，但无法指出是哪一个。

### 7.4.3 内生性检验：是否需要使用IV？——豪斯曼检验

有时我们不确定解释变量 $x_i$ 是否真的内生。**豪斯曼检验**可用于比较 OLS 与 IV 估计量，检验 $H_0: x_i$ 是外生的。 - 基本思想：若 $x_i$ 外生，则 OLS 与 IV 都是一致的，但 OLS 更有效；若 $x_i$ 内生，则只有 IV 一致。因此，两者差异过大时拒绝原假设。 - 实施方法：一种简便做法是在原模型中加入第一阶段回归的残差 $\hat{v}_i$ 作为额外控制变量，然后检验其系数是否显著。若显著，则拒绝外生性假设，支持使用 IV。

## 7.5 工具变量法的应用实例与分析

### 7.5.1 经典案例：教育回报率估计（使用邻近大学作为工具变量）

### 7.5.2 政策评估案例：工会身份对工资的影响（使用法律环境变化作为工具变量）

### 7.5.3 实例解读：如何论证工具变量的合理性

## 7.6 工具变量法的深入议题与扩展

### 7.6.1 局部平均处理效应理论

IV估计量并不总是识别总体平均处理效应。在存在异质性处理效应且个体对工具变量的反应不同时，IV估计的是**局部平均处理效应**（LATE），即“依从者”（其处理状态会因工具变量而改变的子群体）的平均处理效应。理解 LATE 对于正确解释 IV 估计结果至关重要。

### 7.6.2 多个内生变量与多个工具变量的情形

模型可以扩展至包含多个内生变量 $X$ 和多个工具变量 $Z$。识别要求 $L \geq K$（阶条件），且工具变量与内生变量的协方差矩阵满秩（秩条件）。2SLS 估计步骤类似，第一阶段对每个内生变量进行回归，第二阶段将所有内生变量的预测值纳入回归。

### 7.6.3 控制函数法与2SLS的关系

**控制函数法** 是另一种与 2SLS 等价的估计框架。其思路是：将内生变量 $x_i$ 对工具变量回归得到残差 $\hat{v}_i$，然后将 $\hat{v}_i$ 作为控制变量加入原方程进行 OLS 回归。$x_i$ 的系数即为处理效应的一致估计。该方法在非线性模型中尤其有用。

### 7.6.4 工具变量法的局限性与常见误区

1.  **寻找有效工具变量极其困难**：外生性条件在现实中难以满足。
2.  **弱工具变量危害巨大**：可导致比 OLS 更严重的偏差。
3.  **LATE 的解释局限**：IV 估计的是特定群体的效应，不一定能推广到总体。
4.  **忽视检验**：不进行弱工具变量检验和过度识别检验（如果可能）。
5.  **错误解释排他性约束**：忽视工具变量可能通过其他渠道影响结果。

## 本章总结

工具变量法是解决内生性问题、识别因果效应的强大但要求严苛的方法。其有效性完全依赖于工具变量必须同时满足的**相关性**与**外生性**两个核心假设。本章系统介绍了从模型设定、工具变量选择、两阶段最小二乘估计到一系列诊断检验（弱工具变量检验、过度识别检验、内生性检验）的完整流程。

必须清醒认识到，工具变量的“外生性”是一个基于理论与研究设计的**逻辑假设**，无法被数据完全证实。因此，方法的成功应用不仅依赖于统计检验，更取决于工具变量选择的合理性与说服力。研究者必须深入理解其估计的**局部平均处理效应**内涵，并警惕**弱工具变量**可能带来的严重偏差。

工具变量法在应用计量经济学中占据中心地位，但只是因果推断工具箱中的一种。在实践中，应结合研究问题的具体背景，审慎评估其适用性，并考虑与其他方法（如DID、RDD等）相互印证，以得到更可靠的因果结论。