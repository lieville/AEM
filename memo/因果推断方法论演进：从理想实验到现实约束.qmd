---
title: "因果推断方法论演进：从理想实验到现实约束"
format: 
  html:
    mermaid:
      theme: forest
      backgroundColor: transparent
---

## 逻辑演进全景图

```{mermaid}
flowchart TD
    A[随机对照实验 RCT<br/>金标准] --> B{现实约束：无法实验}
    B --> C[第一代：OLS/回归控制<br/>假设：条件独立性]
    C --> D{假设违背：未观测混杂}
    
    D --> E[第二代：自然实验方法]
    E --> F[工具变量法 IV<br/>假设：排他性约束]
    E --> G[断点回归 RD<br/>假设：连续性]
    E --> H[双重差分法 DID<br/>假设：平行趋势]
    
    D --> I[第三代：构造对照组]
    I --> J[倾向得分匹配 PSM<br/>假设：强可忽略性]
    I --> K[合成控制法<br/>假设：可合成性]
    
    D --> L[第四代：面板数据方法]
    L --> M[固定效应模型 FE<br/>假设：时不变混杂]
    
    F & G & H & J & K & M --> N[方法融合与稳健性检验]
```

## 一、基准框架：随机化实验（理想状态）

### 核心特征

-   **处理分配机制**：$T_i \perp \{Y_i(1), Y_i(0), X_i\}$
-   **直接估计**：$\widehat{ATE} = \bar{Y}_1 - \bar{Y}_0$
-   **无需统计调整**：组间可比性由设计保证

### 数学表达

$$
\begin{aligned}
\text{潜在结果框架} &: Y_i = T_i Y_i(1) + (1-T_i) Y_i(0) \\
\text{平均处理效应} &: \tau = \mathbb{E}[Y_i(1) - Y_i(0)] \\
\text{RCT下} &: \tau = \mathbb{E}[Y_i | T_i=1] - \mathbb{E}[Y_i | T_i=0]
\end{aligned}
$$

## 二、观测性研究的方法论演进

### 第一代：条件独立性方法

#### 1. 多元线性回归（OLS虚拟变量法）

$$
Y_i = \alpha + \tau T_i + \beta' X_i + \epsilon_i
$$

**核心假设**： - 条件独立性：$(Y(1), Y(0)) \perp T \mid X$ - 线性形式：处理效应同质且可加 - 无遗漏变量：$\text{Cov}(T, \epsilon \mid X) = 0$

**假设违背后果**： - 未观测混杂 $U$ → $\text{Cov}(T, \epsilon) \neq 0$ - OLS估计量 $\hat{\tau}$ **有偏且不一致**

**图示逻辑**： $$
未观测混杂 U
    ↗   ↖
处理 T    结果 Y
    ↖   ↗
观测控制 X（不完整）
$$

### 第二代：准实验设计方法

#### 2. 工具变量法（IV）

$$
\begin{aligned}
\text{第一阶段} &: T_i = \gamma_0 + \gamma_1 Z_i + \delta' X_i + u_i \\
\text{第二阶段} &: Y_i = \alpha + \tau \hat{T}_i + \beta' X_i + \epsilon_i
\end{aligned}
$$

**识别假设**： 1. **相关性**：$\gamma_1 \neq 0$（工具影响处理） 2. **排他性约束**：$Z \perp Y \mid T, X$（工具仅通过T影响Y） 3. **外生性**：$Z \perp U$（工具与未观测混杂无关）

**方法局限**： - 仅估计**局部平均处理效应**（LATE）：$\tau_{LATE} = \frac{\mathbb{E}[Y|Z=1] - \mathbb{E}[Y|Z=0]}{\mathbb{E}[T|Z=1] - \mathbb{E}[T|Z=0]}$ - 弱工具问题：$\text{Corr}(Z,T)$ 过小 → 估计量方差爆炸

#### 3. 断点回归设计（RD）

$$
\lim_{x \downarrow c} \mathbb{E}[Y|X=x] - \lim_{x \uparrow c} \mathbb{E}[Y|X=x] = \tau_{SRD}
$$

**核心思想**：在临界值$c$附近创造"局部随机化" - 精确RD：$T_i = \mathbb{I}(X_i \geq c)$ - 模糊RD：$\Pr(T_i=1)$ 在$c$处跳跃

**关键假设**： - 连续性：$\mathbb{E}[Y(0)|X]$ 和 $\mathbb{E}[Y(1)|X]$ 在$c$处连续 - 无精确操纵：个体不能完全控制$X$值

**验证方法**： - 协变量连续性检验 - McCrary密度检验

#### 4. 双重差分法（DID）

$$
Y_{it} = \alpha + \tau (D_i \times Post_t) + \beta D_i + \gamma Post_t + \epsilon_{it}
$$

**平行趋势假设**： $$
\mathbb{E}[Y_{i0}(t) - Y_{i0}(t-1) | D_i=1] = \mathbb{E}[Y_{i0}(t) - Y_{i0}(t-1) | D_i=0]
$$

**假设违背的修正**： - 事件研究法：$\tau_k = \mathbb{E}[Y_{t+k} - Y_{t-1} | D=1] - \mathbb{E}[Y_{t+k} - Y_{t-1} | D=0]$ - 三重差分法（DDD）：引入第三重差分维度

### 第三代：构造可比对照组

#### 5. 倾向得分匹配（PSM）

**核心定理（Rosenbaum & Rubin, 1983）**： $$
(Y(1), Y(0)) \perp T \mid X \quad \Rightarrow \quad (Y(1), Y(0)) \perp T \mid p(X)
$$ 其中 $p(X) = \Pr(T=1|X)$

**ATT估计量**： $$
\hat{\tau}_{ATT}^{PSM} = \frac{1}{N_1} \sum_{i \in \mathcal{T}} \left[ Y_i - \sum_{j \in \mathcal{C}} w_{ij} Y_j \right]
$$

**匹配方法比较**： \| 方法 \| 权重 $w_{ij}$ \| 优点 \| 缺点 \| \|------\|--------------\|------\|------\| \| 最近邻 \| $\mathbb{I}(j=\arg\min_k |p_i-p_k|)$ \| 直观 \| 可能匹配差 \| \| 卡尺匹配 \| $\frac{\mathbb{I}(|p_i-p_j|<r)}{\sum_k \mathbb{I}(|p_i-p_k|<r)}$ \| 质量保证 \| 可能损失样本 \| \| 核匹配 \| $\frac{K((p_i-p_j)/h)}{\sum_k K((p_i-p_k)/h)}$ \| 效率高 \| 带宽选择敏感 \|

#### 6. 合成控制法（适用于单案例）

$$
\min_{w} \left\| X_1 - \sum_{j=2}^{J+1} w_j X_j \right\| \quad \text{s.t.} \quad w_j \geq 0, \sum w_j = 1
$$ 合成结果：$Y_1^s(t) = \sum_{j=2}^{J+1} w_j Y_j(t)$ \$\$

**推断方法**：排列检验（Placebo Test） - 将处理"假装"施加于每个控制单元 - 比较真实效应与安慰剂效应的分布

### 第四代：面板数据方法

#### 7. 固定效应模型

$$
Y_{it} = \alpha_i + \tau T_{it} + \beta' X_{it} + \epsilon_{it}
$$

$\text{其中} \alpha_i \text{ 吸收所有时不变混杂}$

**模型变体**： - 双向固定效应：加入时间效应 $\lambda_t$ - 事件研究FE：$\tau_k = \sum_{k=-K}^{K} \beta_k \cdot \mathbb{I}(t-E_i = k)$

**假设检验**： - Hausman检验：FE vs RE - 序列相关检验 - 异方差稳健标准误

## 三、假设验证与稳健性检验框架

### 1. 假设层级金字塔

$$
         ┌─────────────┐
         │  最可信     │ ← RCT, RD
         ├─────────────┤
         │  中等可信   │ ← IV(强理论), DID(证据)
         ├─────────────┤
         │  较低可信   │ ← PSM, OLS, FE
         └─────────────┘
$$

### 2. 可检验 vs 不可检验假设

$$
\text{可检验：平衡性检验、事前趋势、第一阶段F值、协变量连续性} \\
\text{不可检验：排他性约束、无未观测混杂、平行趋势 → 需理论论证}
$$

### 3. 敏感性分析框架

**Rosenbaum界限（PSM）**： $$
\Gamma = \frac{p_i(1-p_j)}{p_j(1-p_i)} \quad \text{衡量未观测混杂强度}
$$

**Altonji比率（IV）**： $$
\text{选择效应比} = \frac{\text{观测变量解释的选择偏误}}{\text{总选择偏误}}
$$

## 四、方法选择决策流程

```{mermaid}
flowchart TD
    Start[研究问题] --> Q1{能否随机化？}
    Q1 -- 能 --> RCT[实施随机对照实验]
    Q1 -- 不能 --> Q2{有无清晰断点？}
    
    Q2 -- 有 --> RD[断点回归设计]
    Q2 -- 无 --> Q3{有无自然实验工具？}
    
    Q3 -- 有 --> IV[工具变量法<br/>检验：第一阶段F>10]
    Q3 -- 无 --> Q4{有无面板数据？}
    
    Q4 -- 有 --> Q5{处理时点是否统一？}
    Q4 -- 无 --> Q6{对照组是否明确？}
    
    Q5 -- 是 --> DID[双重差分法<br/>检验：平行趋势]
    Q5 -- 否 --> FE[固定效应模型<br/>检验：Hausman检验]
    
    Q6 -- 是 --> PSM[倾向得分匹配<br/>检验：平衡性]
    Q6 -- 否 --> SC[合成控制法<br/>检验：安慰剂检验]
    
    RCT & RD & IV & DID & FE & PSM & SC --> Val[多方法三角验证<br/>+ 敏感性分析]
```

## 五、现代发展：机器学习融合

### 1. 双机器学习（Double/Debiased ML）

$$
\text{步骤：} \\
1. \text{用ML估计 } \hat{m}(X) = \mathbb{E}[Y|X] \text{ 和 } \hat{g}(X) = \mathbb{E}[T|X] \\
2. \text{正交化： } \tilde{Y} = Y - \hat{m}(X), \quad \tilde{T} = T - \hat{g}(X) \\
3. \text{估计： } \hat{\tau} = \left( \frac{1}{n} \sum \tilde{T}_i^2 \right)^{-1} \frac{1}{n} \sum \tilde{T}_i \tilde{Y}_i
$$

### 2. 因果森林

-   基于随机森林的异质性处理效应估计
-   诚实树（Honest Trees）：样本分割确保无偏

### 3. 双重稳健估计

$$
\hat{\tau}_{DR} = \frac{1}{n} \sum_{i=1}^n \left[ \frac{T_i(Y_i - \hat{m}_1(X_i))}{\hat{e}(X_i)} - \frac{(1-T_i)(Y_i - \hat{m}_0(X_i))}{1-\hat{e}(X_i)} + \hat{m}_1(X_i) - \hat{m}_0(X_i) \right]
$$ 一致性要求：$\hat{e}(X)$ 或 $\hat{m}_t(X)$ 中至少一个正确

## 六、实践建议清单

### ✅ **必须报告的项目**

1.  **识别假设**：明确陈述并论证
2.  **检验结果**：平衡性、平行趋势、第一阶段等
3.  **敏感性分析**：结论对假设违背的稳健性
4.  **效应异质性**：不同子群体的效应差异
5.  **机制分析**：处理起作用的中介路径

### ⚠️ **常见陷阱**

1.  **坏控制**：控制了中介变量或结果变量
2.  **过度匹配**：PSM中匹配变量包含过多噪音
3.  **弱工具**：IV第一阶段F统计量\<10
4.  **功能性误设**：线性设定忽略非线性关系
5.  **样本选择**：ATT与ATE的混淆

### 🔧 **工具箱选择**

| 情境特征             | 推荐方法 | 补充验证      |
|----------------------|----------|---------------|
| 截面数据，有良好工具 | IV/2SLS  | 过度识别检验  |
| 政策间断点清晰       | RD       | 带宽敏感性    |
| 面板数据，处理统一   | DID      | 事件研究图    |
| 面板数据，处理异时   | FE       | 动态FE模型    |
| 对照组明确，截面数据 | PSM      | Rosenbaum界限 |
| 单案例研究           | 合成控制 | 排列检验      |

------------------------------------------------------------------------

## 总结：因果推断的科学态度

$$
\text{因果推断 = 研究设计 × 统计方法 × 领域知识}
$$

**核心原则**： 1. **透明化**：明确所有假设和检验 2. **三角验证**：多方法相互印证 3. **稳健性导向**：重视结论的稳定性而非显著性 4. **谦虚解释**：承认推断的条件性和不确定性

**最终检验标准**：当向领域专家展示时，他们是否认为你的识别策略在**理论上可信**且**实践上可行**？

------------------------------------------------------------------------

*注：本框架参考自 Angrist & Pischke (2009), Imbens & Rubin (2015), Cunningham (2021) 等经典教材，结合现代方法论发展综合而成。*